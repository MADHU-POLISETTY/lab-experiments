#include <stdio.h>
#include <string.h>

struct File {
    char name[50];
};

struct User {
    char username[50];
    struct File files[50];
    int fileCount;
};

int main() {
    struct User users[10];
    int userCount = 0;

    int choice, i, j, foundUser, foundFile;
    char uname[50], fname[50];

    while (1) {
        printf("\n--- Two Level Directory ---\n");
        printf("1. Create User\n2. Create File\n3. Delete File\n4. Search File\n5. Display All\n6. Exit\n");
        printf("Enter choice: ");
        scanf("%d", &choice);

        switch (choice) {
            case 1:
                printf("Enter new username: ");
                scanf("%s", uname);

                foundUser = 0;
                for (i = 0; i < userCount; i++) {
                    if (strcmp(users[i].username, uname) == 0) {
                        foundUser = 1;
                        break;
                    }
                }

                if (foundUser)
                    printf("User already exists!\n");
                else {
                    strcpy(users[userCount].username, uname);
                    users[userCount].fileCount = 0;
                    userCount++;
                    printf("User created successfully.\n");
                }
                break;

            case 2:
                printf("Enter username: ");
                scanf("%s", uname);

                foundUser = -1;
                for (i = 0; i < userCount; i++) {
                    if (strcmp(users[i].username, uname) == 0) {
                        foundUser = i;
                        break;
                    }
                }

                if (foundUser == -1) {
                    printf("User not found!\n");
                    break;
                }

                printf("Enter file name to create: ");
                scanf("%s", fname);

                foundFile = 0;
                for (j = 0; j < users[foundUser].fileCount; j++) {
                    if (strcmp(users[foundUser].files[j].name, fname) == 0) {
                        foundFile = 1;
                        break;
                    }
                }

                if (foundFile)
                    printf("File already exists for this user!\n");
                else {
                    strcpy(users[foundUser].files[users[foundUser].fileCount].name, fname);
                    users[foundUser].fileCount++;
                    printf("File created successfully.\n");
                }
                break;

            case 3:
                printf("Enter username: ");
                scanf("%s", uname);

                foundUser = -1;
                for (i = 0; i < userCount; i++) {
                    if (strcmp(users[i].username, uname) == 0) {
                        foundUser = i;
                        break;
                    }
                }

                if (foundUser == -1) {
                    printf("User not found!\n");
                    break;
                }

                printf("Enter file name to delete: ");
                scanf("%s", fname);

                foundFile = -1;
                for (j = 0; j < users[foundUser].fileCount; j++) {
                    if (strcmp(users[foundUser].files[j].name, fname) == 0) {
                        foundFile = j;
                        break;
                    }
                }

                if (foundFile == -1)
                    printf("File not found!\n");
                else {
                    for (int k = foundFile; k < users[foundUser].fileCount - 1; k++) {
                        users[foundUser].files[k] = users[foundUser].files[k + 1];
                    }
                    users[foundUser].fileCount--;
                    printf("File deleted successfully.\n");
                }
                break;

            case 4:
                printf("Enter username: ");
                scanf("%s", uname);

                foundUser = -1;
                for (i = 0; i < userCount; i++) {
                    if (strcmp(users[i].username, uname) == 0) {
                        foundUser = i;
                        break;
                    }
                }

                if (foundUser == -1) {
                    printf("User not found!\n");
                    break;
                }

                printf("Enter file name to search: ");
                scanf("%s", fname);

                foundFile = 0;
                for (j = 0; j < users[foundUser].fileCount; j++) {
                    if (strcmp(users[foundUser].files[j].name, fname) == 0) {
                        foundFile = 1;
                        break;
                    }
                }

                if (foundFile)
                    printf("File found in %s directory!\n", uname);
                else
                    printf("File not found!\n");
                break;

            case 5:
                printf("\n--- Directory Structure ---\n");
                for (i = 0; i < userCount; i++) {
                    printf("\nUser: %s\n", users[i].username);
                    if (users[i].fileCount == 0)
                        printf("  No files\n");
                    else {
                        for (j = 0; j < users[i].fileCount; j++)
                            printf("  %s\n", users[i].files[j].name);
                    }
                }
                break;

            case 6:
                return 0;

            default:
                printf("Invalid choice!\n");
        }
    }
}
